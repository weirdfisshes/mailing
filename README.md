# Mailing

Сервис, который по заданным правилам запускает рассылку по списку клиентов.

Реализованы следующие сущности:
# Рассылка
Содержит:
```
- уникальный id рассылки;
- дата и время запуска рассылки;
- текст сообщения для доставки клиенту;
- фильтр свойств клиентов, на которых должна быть произведена рассылка (код мобильного оператора, тег);
- дата и время окончания рассылки: если по каким-то причинам не успели разослать все сообщения - никакие сообщения клиентам после этого времени доставляться не должны.
```

# Клиент
Содержит:
```
- уникальный id клиента;
- номер телефона клиента в формате 7XXXXXXXXXX (X - цифра от 0 до 9);
- код мобильного оператора;
- тег (произвольная метка);
- часовой пояс.
```

# Сообщение
Содержит:
```
- уникальный id сообщения;
- дата и время создания (отправки);
- статус отправки;
- id рассылки, в рамках которой было отправлено сообщение;
- id клиента, которому отправили.
```

# С помощью API можно
```
- добавить нового клиента в справочник со всеми его атрибутами;
- обновить данные атрибутов клиента;
- удалить клиента из справочника;
- добавить новую рассылку со всеми её атрибутами;
- получить общую статистику по созданным рассылкам и количеству отправленных сообщений по ним с группировкой по статусам;
- получить детальную статистику отправленных сообщений по конкретной рассылке;
- обновить атрибуты рассылки;
- удалить рассылки;
- обработать активные рассылки и отправить сообщения клиентам.
```

Реализовано откладывание запросов при неуспехе.

### Как запустить проект:

Установите и запустите Redis на своем локальном сервере:

```
sudo apt-get update
sudo apt-get install redis
sudo service redis-server start
```

Клонируйте репозиторий, в корне создайте файл .env, заполнить его по образцу:

```
TOKEN='<ваш токен для отправки сообщений через API>'
URL='<URL сервиса отправки сообщений>'
SECRET_KEY='<django_sekret_key>'
```
Создайте и активируйте виртуальное окружение:

```
py -3.10 -m venv venv
source venv/Scripts/activate

```

Установите зависимости из файла req.pip:

```
pip install -r req.pip
```

Перейдите в папку с manage.py и выполните миграции:

```
py manage.py migrate
```

Создайте суперюзера:

```
py manage.py createsuperuser

```

Запустите проект:

```
py manage.py runserver

```

Запустите Celery из папки mailing/mailing, например, в Windows (WSL):

```
celery -A mailing worker --loglevel=info --pool=solo

```
Запустите Flower:

```
celery -A mailing flower --port=5555

```

Проект будет доступен по адресу:

```
http://127.0.0.1:8000/

```

Админ-панель доступна по адресу:

```
http://127.0.0.1:8000/admin
```

Документация к API доступна по адресу:

```
http://127.0.0.1:8000/swagger/
```

Создайте тестовых клиентов и рассылки через Postman или админ-панель.
За статусом рассылок и сообщений можно следить по адресу http://127.0.0.1:5555/ (flower), через Postman (эндпоинты в http://127.0.0.1:8000/swagger/), либо через админ-панель


### Технологии:

Python 3.10, Django, DRF, Celery, Redis, Swagger, Flower, dotenv

### Автор:

Никита Бурцев (https://t.me/telekasster)